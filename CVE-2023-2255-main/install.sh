#!/bin/bash

# Ensure the script is run as root
if [ "$(id -u)" -ne 0 ]; then
  echo "This script must be run as root or with sudo." >&2
  exit 1
fi

# Define the URL for the LibreOffice 2022 version (e.g., 7.4.0.1)
LIBREOFFICE_VERSION="7.4.0.1"
LIBREOFFICE_URL="https://downloadarchive.documentfoundation.org/libreoffice/old/7.4.0.1/deb/x86_64/LibreOffice_7.4.0.1_Linux_x86-64_deb.tar.gz"

# Create a temporary directory for the download
TEMP_DIR=$(mktemp -d)

# Download the LibreOffice tarball
echo "Downloading LibreOffice $LIBREOFFICE_VERSION..."
wget -q -O "$TEMP_DIR/libreoffice.tar.gz" "$LIBREOFFICE_URL"

# Check if the download was successful
if [ $? -ne 0 ]; then
  echo "Failed to download LibreOffice $LIBREOFFICE_VERSION. Exiting." >&2
  exit 1
fi

# Extract the tarball
echo "Extracting LibreOffice package..."
tar -xzf "$TEMP_DIR/libreoffice.tar.gz" -C "$TEMP_DIR"

# Install the extracted .deb packages
echo "Installing LibreOffice $LIBREOFFICE_VERSION..."
sudo dpkg -i "$TEMP_DIR"/LibreOffice_*/DEBS/*.deb

# Fix any dependency issues
echo "Fixing any missing dependencies..."
sudo apt-get install -f -y

# Clean up
echo "Cleaning up temporary files..."
rm -rf "$TEMP_DIR"

# Verify installation
echo "Verifying LibreOffice installation..."
libreoffice --version

echo "LibreOffice $LIBREOFFICE_VERSION installation completed."

